#!/usr/bin/perl
#
# TODO: Wire this up to an Action workflow
#
# ./bin/remove_old_ads < docs/perl_ads.json > docs/perl_ads.json.new
# mv docs/perl_ads.json.new docs/perl_ads.json
# git commit ...

use strict;
use warnings;

use feature 'say';

use JSON;
use Time::Piece;

my $parser = JSON->new->pretty;

my $json = do { local $/; <> };

my $ads = $parser->decode($json);

my $today = localtime->ymd;

my @filtered_ads = grep {
  ! exists $_->{end} or ! defined $_->{end} or $_->{end} gt $today;
} @$ads;

say $parser->encode(\@filtered_ads);
